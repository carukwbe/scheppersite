

<div class="content">
    <div class="ticketCount" id="ticketCount">
        Noch <strong>{{ availableTickets$ | async }}</strong> Tickets verfügbar! <br>
    </div>
    <div class="priceBoxes">
        <div class="box" *ngFor="let ticketLevel of ticketLevels" [ngClass]="{ 'active': ticketLevel.active }" [matTooltip]="'ab ' + ticketLevel.activationDate">
            <div class="name">{{ ticketLevel.name }}</div>
            <div style="font-size: 18px; font-weight: bold;">{{ ticketLevel.price }}€</div>
        </div>
    </div>

    <form [formGroup]="ticketInfos">
        <mat-form-field>
            <mat-label>Vorname</mat-label>
            <input type="text" id="name" matInput formControlName="name">
        </mat-form-field>
    
        <mat-form-field>
            <mat-label>Name</mat-label>
            <input type="text" id="surname" matInput formControlName="surname">
        </mat-form-field>
    
        <mat-form-field>
            <mat-label>E-Mail</mat-label>
            <input type="email" id="email" matInput formControlName="email" email>
            <mat-error *ngIf="ticketInfos.get('email')?.hasError('email') && ticketInfos.get('email')?.touched">Gib eine gültige E-Mail
                Adresse ein!</mat-error>
        </mat-form-field>
    
        <mat-form-field  matTooltip="Damit wir dich kontaktieren können, falls was schief geht. Zusätzlich landest du in der WhatsApp Gruppe!">
            <mat-label>Telefonnummer</mat-label>
            <input type="tel" id="phone" matInput formControlName="phone">
        </mat-form-field>

        <div [class.carpassDisabled]="availableCarPasses < 1">
            <!-- <img *ngIf="availableCarPasses < 1" src="../../../assets/ausverkauft.png" alt="" class="ausverkauft" style="z-index: -1;"> -->
            <mat-checkbox formControlName="carpass">
                Carpass <br>
                <p>
                    Zahle 5€ mehr um in dein Auto auch auf dem Gelände schlummern zu lassen.
                </p>
            </mat-checkbox>
        </div>
        <p class="indented" style="z-index: 0;">
             Außerhalb gibt es sonst auch in unmittelbarer Nähe genug Parkplätze zum Campen im Auto.
        </p>
        <ng-container *ngIf="availableCarPasses < 1">
            <mat-checkbox formControlName="carpassWanted">Carpass hätte ich gern noch genommen</mat-checkbox>
            <div class="indented">
                <p>
                    Für Statistikzwecke. Evtl. können wir einen Sponti-Carpass-Verkauf vor Ort ermöglichen, je nach Platzlage.
                </p>
            </div>
        </ng-container>


        <div class="line" style="margin: 10px 0 15px 0; width: 100px;"></div>

        <mat-checkbox formControlName="helper">Ich möchte Helfer*in werden!</mat-checkbox>




        <div class="indented" *ngIf="ticketInfos.get('helper')!.value" [@slideInFromTop]>
            <!-- <div class="line" style="margin: 10px 0;"></div> -->
            <p>
                Dein Ticketpreis reduziert sich um die Hälfte, und erfordert eine Mindestanzahl von 6 Stunden geleisteter Schichten. 
                Bei mehr Arbeitszeit erhältst du weitere Aufwandsentschädigungen in Form von Getränke- und Essensmarken!
            </p>
                


            <p>Bereiche in denen ich mich sehe:</p>
            <mat-form-field>
                <!-- <mat-label>Bereiche in denen ich mich sehe!</mat-label> -->
                <mat-select multiple formControlName="helperAreas">
                    <mat-option [value]="'bar'">Bar</mat-option>
                    <mat-option [value]="'küche'">Küche</mat-option>
                    <mat-option [value]="'einlass'">Einlass</mat-option>
                    <mat-option [value]="'awareness'">Awareness</mat-option>
                    <mat-option [value]="'security'">Security</mat-option>
                    <mat-option [value]="'aufbau'">Aufbau</mat-option>
                    <mat-option [value]="'abbau'">Abbau</mat-option>
                </mat-select>
            </mat-form-field>
            <p>
                Beachte, dass es sich dabei nur um Wünsche handelt, den tatsächlichen Einsatzbereich werden wir erst kurz vorher
                planen können.
                Security wird nur mit entsprechender Vorerfahrung/ Qualifikation möglich sein.
            </p>

            <div class="line" style="margin: 10px 0; width: 100px;"></div>

            <p>Gib uns Infos über dich, z.B. wie deine zeitlichen Präferenzen für Arbeitszeiten so sind</p>

            <mat-form-field>
                <!-- <mat-label>Gib uns Infos über dich die wir wissen sollten und was deine zeitlichen Präferenzen sind.</mat-label> -->
                <textarea matInput formControlName="helperComment"></textarea>
            </mat-form-field>

            <!-- <div class="line" style="margin-bottom: 20px;"></div> -->
        </div>
        
        <div class="line" style="margin: 15px 0 15px 0; width: 100px;"></div>

        <mat-checkbox formControlName="agbsAccepted">Bei den AGBs bin ich sowas von dabei*</mat-checkbox>
        <mat-checkbox formControlName="dataProtectionAccepted">Datenschutzhinweise hab ich nicht gelesen, stimm' ich aber trotzdem zu!*</mat-checkbox>
    
        <div class="info">
            <p>
                Du erhältst eine E-Mail mit Bankdaten für die Überweisung.
                Unser System checkt täglich einkommende Überweisungen und sendet dann die entsprechenden Tickets heraus.
                Es kann also durchaus ein paar Tage dauern, bis du dein Ticket erhältst.
            </p>
        </div>

        <div class="priceComponent">
            <div class="line"></div>
            <div class="price">
                <p>Dein Ticketpreis</p>
                <p style="font-size: 25px;">{{ ticketInfos.get('helper')!.value ? currentPriceHelper : currentPrice }}€</p>
            </div>
            <div class="line" style="margin-bottom: 10px;"></div>
        </div>

        <button mat-raised-button color="primary" (click)="submit()" [disabled]="ticketInfos.invalid">
            Kauf bestätigen
        </button>
    
        <mat-spinner *ngIf="isLoading"></mat-spinner>
        <div *ngIf="statusMessage">{{ statusMessage }}</div>
    </form>
    
    <!-- <mat-stepper #stepper>
        <mat-step [stepControl]="ticketInfos" errorMessage="Name is required.">
            <form [formGroup]="ticketInfos">
                <ng-template matStepLabel>Allgemeine Infos</ng-template>

                <div>
                    <p>Go to a different step to see the error state</p>
                    <button mat-button matStepperNext>Next</button>
                </div>
            </form>
        </mat-step>
        <mat-step [stepControl]="helperInfos" errorMessage="Address is required.">
            <form [formGroup]="helperInfos">
                <ng-template matStepLabel>Helfer werden</ng-template>

                <div>
                    <p>Go to a different step to see the error state</p>
                    <button mat-button matStepperPrevious>Back</button>
                    <button mat-button matStepperNext>Next</button>
                </div>
            </form>
        </mat-step>
        <mat-step>
            <ng-template matStepLabel>Kauf abschließen</ng-template>
            <p>You are now done.</p>
            <div>
                <button mat-button matStepperPrevious>Back</button>
                <button mat-button (click)="stepper.reset()">Reset</button>
            </div>
        </mat-step>
    </mat-stepper> -->
    
    
    
    
    
    <!-- debug -->
    <div class="ticketContainer">
        <div *ngFor="let ticket of tickets" class="ticket-card" (click)="routeToTicketEdit(ticket)">
            <h2>{{ ticket.name }} {{ ticket.surname }}</h2>
            <p>TicketID: {{ ticket.id }}</p>
            <p>Email: {{ ticket.email }}</p>
            <p>Phone: {{ ticket.phone }}</p>
            <p>Price: {{ ticket.price }}</p>
            <p>Payed: {{ ticket.payed ? 'Yes' : 'No' }}</p>
            <p>Ticket Sent: {{ ticket.ticket_sent ? 'Yes' : 'No' }}</p>
            <p>Created: {{ ticket.created }}</p>
            <p>Status: {{ ticket.status }}</p>
            <p>Old TicketID: {{ ticket.old_ticketID }}</p>
        </div>
    </div>
</div>


